<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Service Coin - Staking DApp</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.12.1/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        #notification-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            transition: opacity 0.5s, transform 0.5s;
            opacity: 0;
            pointer-events: none;
            z-index: 100;
        }
        #notification-toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
            pointer-events: auto;
        }
    </style>
</head>
<body class="bg-[#f8f8f7] text-[#1a1a1a] font-sans antialiased">
    
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-200">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <a href="index.html">
                    <img src="https://images.squarespace-cdn.com/content/v1/679f0671ab24eb0464140c44/5d7925b6-6845-4daa-b832-130180999070/black_logo_transparent_background.png?format=1500w" alt="Service Logo" class="h-8 w-auto">
                </a>

                <!-- Desktop Navigation -->
                <nav class="hidden md:flex items-center space-x-8">
                    <a href="index.html#apps" class="text-gray-700 hover:text-black transition-colors">App Development</a>
                    <a href="index.html#staking" class="text-gray-700 hover:text-black transition-colors">Staking</a>
                    <a href="whitepaper.html" class="text-gray-700 hover:text-black transition-colors">Whitepaper</a>
                </nav>

                <!-- CTA Button -->
                <div class="hidden md:block">
                    <a href="mailto:info@service.money" class="bg-transparent text-black border border-gray-300 px-6 py-3 rounded-md font-semibold hover:bg-gray-100 transition-colors duration-300">Contact</a>
                </div>

                 <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button id="mobile-menu-button-header" class="text-black focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu-header" class="hidden md:hidden px-6 pt-2 pb-4 border-t border-gray-200 bg-white">
            <a href="index.html#apps" class="block py-2 text-gray-700 hover:text-black">App Development</a>
            <a href="index.html#staking" class="block py-2 text-gray-700 hover:text-black">Staking</a>
            <a href="whitepaper.html" class="block py-2 text-gray-700 hover:text-black">Whitepaper</a>
            <a href="mailto:info@service.money" class="block mt-2 text-center bg-transparent text-black border border-gray-300 px-6 py-3 rounded-md font-semibold hover:bg-gray-100 transition-colors duration-300 w-full">Contact</a>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-6">
        <h1 class="text-3xl font-bold mb-6 text-center">Service Coin DApp</h1>
        
        <div id="connect-wallet-container" class="text-center bg-white border border-gray-200 p-8 rounded-lg shadow-md max-w-lg mx-auto">
            <h2 class="text-2xl font-bold mb-4">Connect Your Wallet</h2>
            <p id="wallet-instructions" class="text-gray-500 mb-6">Please connect your wallet to view the dashboard.</p>
            <button id="connect-wallet-btn" class="bg-black hover:bg-gray-800 text-white font-bold py-3 px-6 rounded-md transition-colors text-lg">Connect Wallet</button>
        </div>

        <div id="dashboard-content" class="hidden">
            <div class="bg-white border border-gray-200 p-4 rounded-lg mb-6 shadow-sm">
                <p><strong>Wallet:</strong> <span id="wallet">-</span></p>
                <p class="text-sm text-gray-500">View your verified holdings, staking receipts, and redemption timeline.</p>
            </div>

            <div class="grid lg:grid-cols-5 gap-6">
                <div class="lg:col-span-3 space-y-6">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-white border border-gray-200 p-4 rounded-lg shadow-sm">
                            <p class="text-lg font-bold">SRV Balance</p>
                            <p id="srv-balance" class="text-2xl font-mono">0.00</p>
                            <p class="text-sm text-gray-500">The token required for staking.</p>
                        </div>
                         <div class="bg-white border border-gray-200 p-4 rounded-lg shadow-sm">
                            <p class="text-lg font-bold">SREV Balance</p>
                            <p id="srev-balance" class="text-2xl font-mono">0.00</p>
                            <p class="text-sm text-gray-500">Auto-yielding USDC receipt</p>
                        </div>
                    </div>

                    <div class="bg-white border border-gray-200 p-4 rounded-lg shadow-sm">
                        <h3 class="text-xl font-bold mb-4">SRV Staking</h3>
                         <div class="mb-6 border-b border-gray-200 pb-6">
                            <label for="stake-amount" class="block text-sm font-medium text-gray-600 mb-2">Stake SRV targeting a 5% APR.</label>
                            <div class="flex flex-col sm:flex-row gap-2">
                                <input type="text" id="stake-amount" placeholder="SRV Amount" class="bg-gray-50 border border-gray-300 text-gray-900 rounded-md p-2 flex-grow focus:ring-2 focus:ring-black focus:outline-none">
                                <button id="approve-stake-btn" class="bg-transparent hover:bg-gray-100 text-black font-bold py-2 px-4 rounded-md transition-colors border border-gray-300">Approve SRV</button>
                                <button id="stake-btn" class="bg-black hover:bg-gray-800 text-white font-bold py-2 px-4 rounded-md transition-colors opacity-50 cursor-not-allowed" disabled>Stake</button>
                            </div>
                            <p class="text-xs text-gray-400 mt-2">First approve, then stake. Unstake at anytime.</p>
                         </div>
                        <div class="flex flex-wrap gap-2">
                          <button id="unstake" class="bg-transparent hover:bg-gray-100 text-black font-bold py-2 px-4 rounded-md transition-colors border border-gray-300">Unstake All SRV</button>
                        </div>
                    </div>
                    
                    <div class="bg-white border border-gray-200 p-4 rounded-lg shadow-sm">
                        <h3 class="text-xl font-bold mb-4">Real Yield System</h3>
                        
                         <div class="mb-6 border-b border-gray-200 pb-6">
                            <label for="deposit-amount" class="block text-sm font-medium text-gray-600 mb-2">Deposit USDC to automatically earn a portion of the platform's real revenue as yield.</label>
                            <div class="flex flex-col sm:flex-row gap-2">
                                <input type="text" id="deposit-amount" placeholder="USDC Amount" class="bg-gray-50 border border-gray-300 text-gray-900 rounded-md p-2 flex-grow focus:ring-2 focus:ring-black focus:outline-none">
                                <button id="approve-deposit-btn" class="bg-transparent hover:bg-gray-100 text-black font-bold py-2 px-4 rounded-md transition-colors border border-gray-300">Approve</button>
                                <button id="deposit-btn" class="bg-black hover:bg-gray-800 text-white font-bold py-2 px-4 rounded-md transition-colors opacity-50 cursor-not-allowed" disabled>Deposit</button>
                            </div>
                            <p class="text-xs text-gray-400 mt-2">First approve, then deposit. Lockup period is 30 days.</p>
                         </div>
                    
                        <div class="flex flex-wrap gap-2">
                            <button id="vault-claim-yield-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition-colors">Claim Yield</button>
                            <button id="vault-compound-yield-btn" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded-md transition-colors">Compound Yield</button>
                            <button id="vault-withdraw-all-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md transition-colors">Withdraw All</button>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-2 space-y-6">
                   <div class="bg-white border border-gray-200 p-4 rounded-lg shadow-sm">
                        <h3 class="text-xl font-bold mb-4">Service Business Revenue</h3>
                        <p class="text-sm">Pool Balance: <span id="staking-pool-balance">0.00 USDC</span></p>
                        <p class="text-sm">Your Pending Rewards: <span id="staking-pending-rewards">0.00 USDC</span></p>
                        <button id="claim-staking-yield-btn" class="mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition-colors w-full">Claim Yield (Staking)</button>
                    </div>
                    <div class="bg-white border border-gray-200 p-4 rounded-lg shadow-sm">
                        <h3 class="text-xl font-bold mb-4">Real Yield System Stats</h3>
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div>
                                <p class="text-sm text-gray-500">Total Shares </p>
                                <p id="platform-investor-vault-balance" class="text-lg font-mono">$0.00</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Total Capital Deposited</p>
                                <p id="platform-total-deposited" class="text-lg font-mono">$0.00</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Yield Vault Balance</p>
                                <p id="platform-yield-vault-balance" class="text-lg font-mono">$0.00</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Total Fees Processed</p>
                                <p id="platform-total-fees" class="text-lg font-mono">$0.00</p>
                            </div>
                           </div>
                       <div class="bg-gray-50 border border-gray-200 p-4 rounded-lg shadow-inner mt-4">
                            <p class="text-lg font-bold">Your Real Yield Rewards</p>
                            <p class="text-sm text-gray-500">USDC earned in vault</p>
                            <p id="vault-claimable-yield" class="text-lg font-mono">$0.00</p>
                         </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <div id="notification-toast" class="px-4 py-2 rounded-lg shadow-lg text-white">
        <span id="notification-message"></span>
    </div>

    <!-- Footer -->
    <footer class="border-t border-gray-200 bg-white mt-12">
         <div class="container mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- Logo and mission -->
                <div class="md:col-span-1">
                    <a href="index.html">
                         <img src="https://images.squarespace-cdn.com/content/v1/679f0671ab24eb0464140c44/5d7925b6-6845-4daa-b832-130180999070/black_logo_transparent_background.png?format=1500w" alt="Service Logo" class="h-8 w-auto">
                    </a>
                    <p class="mt-4 text-gray-500">Custom app solutions.</p>
                    <div class="mt-6 flex space-x-4">
                        <a href="https://x.com/ServiceCoin21" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-black"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.71v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg></a>
                    </div>
                </div>

                <!-- Links -->
                <div class="mt-8 md:mt-0">
                    <h3 class="font-semibold text-gray-900">Services</h3>
                    <ul class="mt-4 space-y-2">
                        <li><a href="index.html#apps" class="text-gray-500 hover:text-gray-900">For Businesses</a></li>
                        <li><a href="index.html#staking" class="text-gray-500 hover:text-gray-900">Staking</a></li>
                    </ul>
                </div>

                <div class="mt-8 md:mt-0">
                    <h3 class="font-semibold text-gray-900">Company</h3>
                    <ul class="mt-4 space-y-2">
                        <li><a href="#" class="text-gray-500 hover:text-gray-900">About Us</a></li>
                        <li><a href="mailto:info@service.money" class="text-gray-500 hover:text-gray-900">Contact</a></li>
                    </ul>
                </div>

                <div class="mt-8 md:mt-0">
                    <h3 class="font-semibold text-gray-900">Legal</h3>
                    <ul class="mt-4 space-y-2">
                        <li><a href="terms.html" class="text-gray-500 hover:text-gray-900">Terms of Service</a></li>
                        <li><a href="privacy.html" class="text-gray-500 hover:text-gray-900">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>

            <div class="mt-12 pt-8 border-t border-gray-200 text-center text-sm text-gray-500">
                <p>&copy; 2024 Service. All rights reserved.</p>
            </div>
        </div>
    </footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
    // --- Mobile Menu Toggle for Header ---
    const mobileMenuButtonHeader = document.getElementById('mobile-menu-button-header');
    const mobileMenuHeader = document.getElementById('mobile-menu-header');
    if(mobileMenuButtonHeader) {
        mobileMenuButtonHeader.addEventListener('click', () => {
            mobileMenuHeader.classList.toggle('hidden');
        });
    }

    // --- Ethers.js Setup ---
    let provider, signer, currentAddress;
    let srvTokenAddress; 

    const RPC_URL = "https://arb-mainnet.g.alchemy.com/v2/YR7lOxqhQTfK1wkrk6Jk7";
    const readProvider = new ethers.JsonRpcProvider(RPC_URL);

    // --- Contract Addresses ---
    const addresses = {
        usdc: "0xaf88d065e77c8cC2239327C5EDb3A432268e5831",
        srev: "0x2F745Da2FA453ee76c756fADcc081f59284B2a40",
        rewardDistributor: "0x71f618EFb0422687e5B2ad9cD973aDACb645D9DE",
        stakingVault: "0x691e29E98ECDc5ae948355F30102cD4D637eddB7",
        investorVault: "0x043B9b9Ec0aEB59d3081AcA4aA210a1df8459F18",
        yieldVault: "0x44D64E1B9dC5F90b389900Da24B8de631222432C",
    };

    // --- ABIs ---
    const abis = {
        erc20: JSON.parse(`["function approve(address spender, uint256 amount) external returns (bool)","function balanceOf(address owner) view returns (uint256)","function allowance(address owner, address spender) view returns (uint256)"]`),
        srev: JSON.parse(`[{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]`),
        staking: JSON.parse(`[{"inputs":[],"name":"SRV","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"stake","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"staked","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"unstake","outputs":[],"stateMutability":"nonpayable","type":"function"}]`),
        rewardDistributor: JSON.parse(`[{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"viewPending","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"viewRewardPoolBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claim","outputs":[],"stateMutability":"nonpayable","type":"function"}]`),
        investorVault: JSON.parse(`[{"inputs":[{"internalType":"address","name":"investor","type":"address"}],"name":"claimableYield","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"investor","type":"address"}],"name":"getInvestorInfo","outputs":[{"internalType":"uint256","name":"share","type":"uint256"},{"internalType":"uint256","name":"claimable","type":"uint256"},{"internalType":"uint256","name":"claimed","type":"uint256"},{"internalType":"uint256","name":"unlockTime","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getVaultTotals","outputs":[{"internalType":"uint256","name":"totalUSDC","type":"uint256"},{"internalType":"uint256","name":"totalSharesMinted","type":"uint256"},{"internalType":"uint256","name":"totalYield","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalDeposits","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"deposit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"claimYield","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"compoundYield","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"shareAmount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"shares","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]`),
        yieldVault: JSON.parse(`[{"inputs":[],"name":"getVaultBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalFeesAccumulatedInVault","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]`),
    };

    // --- UI Elements ---
    const connectWalletBtn = document.getElementById('connect-wallet-btn');

    // --- Helper Functions ---
    function showNotification(message, isError = false) {
        const notificationToast = document.getElementById('notification-toast');
        const notificationMessage = document.getElementById('notification-message');
        notificationMessage.textContent = message;
        notificationToast.className = `px-4 py-2 rounded-lg shadow-lg text-white ${isError ? 'bg-red-600' : 'bg-gray-800'}`;
        notificationToast.classList.add('show');
        setTimeout(() => { notificationToast.classList.remove('show'); }, 4000);
    }

    function formatCurrency(value) {
        return `$${parseFloat(value).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
    }

    // --- Core Application Logic ---
    async function connectAndLoadDashboard() {
        if (!window.ethereum) {
            return showNotification("No wallet detected. Please install MetaMask.", true);
        }
        try {
            provider = new ethers.BrowserProvider(window.ethereum);
            signer = await provider.getSigner();
            currentAddress = await signer.getAddress();
            
            document.getElementById("wallet").innerText = `${currentAddress.substring(0, 6)}...${currentAddress.substring(currentAddress.length - 4)}`;
            document.getElementById('connect-wallet-container').classList.add('hidden');
            document.getElementById('dashboard-content').classList.remove('hidden');

            fetchAllData();
        } catch (error) {
            console.error("Connection failed:", error);
            showNotification("Failed to connect to wallet.", true);
        }
    }

    async function fetchAllData() {
        if (!currentAddress) return;
        try {
            const srevReader = new ethers.Contract(addresses.srev, abis.srev, readProvider);
            const rewardDistributorReader = new ethers.Contract(addresses.rewardDistributor, abis.rewardDistributor, readProvider);
            const investorVaultReader = new ethers.Contract(addresses.investorVault, abis.investorVault, readProvider);
            const yieldVaultReader = new ethers.Contract(addresses.yieldVault, abis.yieldVault, readProvider);
            const stakingVaultReader = new ethers.Contract(addresses.stakingVault, abis.staking, readProvider);
            
            srvTokenAddress = await stakingVaultReader.SRV();
            const srvReader = new ethers.Contract(srvTokenAddress, abis.erc20, readProvider);

            const [
                srevBal, srvBal, vaultInfo, vaultTotals, yieldVaultBalance, totalFees,
                stakingPoolBalance, stakingPendingRewards
            ] = await Promise.all([
                srevReader.balanceOf(currentAddress),
                srvReader.balanceOf(currentAddress),
                investorVaultReader.getInvestorInfo(currentAddress),
                investorVaultReader.getVaultTotals(),
                yieldVaultReader.getVaultBalance(),
                yieldVaultReader.totalFeesAccumulatedInVault(),
                rewardDistributorReader.viewRewardPoolBalance(),
                rewardDistributorReader.viewPending(currentAddress),
            ]);

            document.getElementById("srev-balance").innerText = parseFloat(ethers.formatUnits(srevBal, 18)).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById("srv-balance").innerText = parseFloat(ethers.formatUnits(srvBal, 18)).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById("vault-claimable-yield").innerText = formatCurrency(ethers.formatUnits(vaultInfo.claimable, 6));
            
            document.getElementById("platform-investor-vault-balance").innerText = formatCurrency(ethers.formatUnits(vaultTotals.totalSharesMinted, 6));
            document.getElementById("platform-total-deposited").innerText = formatCurrency(ethers.formatUnits(vaultTotals.totalUSDC, 6));
            document.getElementById("platform-yield-vault-balance").innerText = formatCurrency(ethers.formatUnits(yieldVaultBalance, 6));
            document.getElementById("platform-total-fees").innerText = formatCurrency(ethers.formatUnits(totalFees, 6));
            
            document.getElementById("staking-pool-balance").innerText = `${parseFloat(ethers.formatUnits(stakingPoolBalance, 6)).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} USDC`;
            document.getElementById("staking-pending-rewards").innerText = `${parseFloat(ethers.formatUnits(stakingPendingRewards, 18)).toLocaleString(undefined, {minimumFractionDigits: 4, maximumFractionDigits: 4})} USDC`;

        } catch (error) {
            console.error("Data fetch failed:", error);
            showNotification("Failed to fetch dashboard data. Check console for details.", true);
        }
    }

    // --- Action Handlers (using signer) ---
    async function handleTransaction(action, successMessage, failureMessage) {
        if (!signer) return showNotification("Please connect your wallet first.", true);
        showNotification(`${failureMessage}...`);
        try {
            const tx = await action();
            showNotification("Transaction sent, waiting for confirmation...");
            await tx.wait();
            showNotification(successMessage, false);
            fetchAllData(); // Refresh data after transaction
        } catch (error) {
            console.error(`${failureMessage} failed:`, error);
            const reason = error.reason || "Transaction reverted.";
            showNotification(`${failureMessage} failed: ${reason}`, true);
        }
    }

    // --- Event Listeners Setup ---
    connectWalletBtn.addEventListener('click', connectAndLoadDashboard);
    
    // --- SRV Staking Event Listeners ---
    document.getElementById('approve-stake-btn').addEventListener('click', async () => {
        const amount = document.getElementById('stake-amount').value;
        if (!amount || isNaN(amount) || parseFloat(amount) <= 0) return showNotification("Please enter a valid amount.", true);
        if (!srvTokenAddress) return showNotification("SRV token address not found.", true);
        
        const srvContract = new ethers.Contract(srvTokenAddress, abis.erc20, signer);
        await handleTransaction(
            () => srvContract.approve(addresses.stakingVault, ethers.parseUnits(amount, 18)),
            "Approval successful! You can now stake.",
            "Approving SRV"
        );
        document.getElementById('stake-btn').disabled = false;
        document.getElementById('stake-btn').classList.remove('opacity-50', 'cursor-not-allowed');
    });

    document.getElementById('stake-btn').addEventListener('click', async () => {
        const amount = document.getElementById('stake-amount').value;
        if (!amount || isNaN(amount) || parseFloat(amount) <= 0) return showNotification("Please enter a valid amount.", true);

        const stakingContract = new ethers.Contract(addresses.stakingVault, abis.staking, signer);
        await handleTransaction(
            () => stakingContract.stake(ethers.parseUnits(amount, 18)),
            "Stake successful!",
            "Staking SRV"
        );
    });

    document.getElementById('unstake').addEventListener('click', async () => {
        const stakingContract = new ethers.Contract(addresses.stakingVault, abis.staking, signer);
        const stakedAmount = await stakingContract.staked(currentAddress);
        if (stakedAmount === 0n) return showNotification("You have no SRV staked.", true);

        await handleTransaction(
            () => stakingContract.unstake(stakedAmount),
            "Unstake successful!",
            "Unstaking SRV"
        );
    });
    
    // --- USDC Deposit Event Listeners ---
    document.getElementById('approve-deposit-btn').addEventListener('click', async () => {
        const amount = document.getElementById('deposit-amount').value;
        if (!amount || isNaN(amount) || parseFloat(amount) <= 0) return showNotification("Please enter a valid amount.", true);
        
        const usdcContract = new ethers.Contract(addresses.usdc, abis.erc20, signer);
        await handleTransaction(
            () => usdcContract.approve(addresses.investorVault, ethers.parseUnits(amount, 6)),
            "Approval successful! You can now deposit.",
            "Approving USDC"
        );
        document.getElementById('deposit-btn').disabled = false;
        document.getElementById('deposit-btn').classList.remove('opacity-50', 'cursor-not-allowed');
    });

    document.getElementById('deposit-btn').addEventListener('click', async () => {
        const amount = document.getElementById('deposit-amount').value;
        if (!amount || isNaN(amount) || parseFloat(amount) <= 0) return showNotification("Please enter a valid amount.", true);
        
        const investorVaultContract = new ethers.Contract(addresses.investorVault, abis.investorVault, signer);
        await handleTransaction(
            () => investorVaultContract.deposit(ethers.parseUnits(amount, 6)),
            "Deposit successful!",
            "Depositing USDC"
        );
    });

    // --- Real Yield System Event Listeners ---
    document.getElementById('vault-claim-yield-btn').addEventListener('click', async () => {
        const investorVaultContract = new ethers.Contract(addresses.investorVault, abis.investorVault, signer);
        await handleTransaction(
            () => investorVaultContract.claimYield(),
            "Yield claimed successfully!",
            "Claiming Yield"
        );
    });

    document.getElementById('vault-compound-yield-btn').addEventListener('click', async () => {
        const investorVaultContract = new ethers.Contract(addresses.investorVault, abis.investorVault, signer);
        await handleTransaction(
            () => investorVaultContract.compoundYield(),
            "Yield compounded successfully!",
            "Compounding Yield"
        );
    });

    document.getElementById('vault-withdraw-all-btn').addEventListener('click', async () => {
        const investorVaultContract = new ethers.Contract(addresses.investorVault, abis.investorVault, signer);
        const userInfo = await investorVaultContract.getInvestorInfo(currentAddress);
        const userShares = userInfo.share;

        if (userShares === 0n) {
            return showNotification("You have no shares to withdraw.", true);
        }
        
        const unlockTime = userInfo.unlockTime;
        if (Date.now() / 1000 < unlockTime) {
            const unlockDate = new Date(Number(unlockTime) * 1000).toLocaleString();
            return showNotification(`Your funds are locked until ${unlockDate}.`, true);
        }
        
        await handleTransaction(
            () => investorVaultContract.withdraw(userShares),
            "Withdrawal successful!",
            "Withdrawing All Funds"
        );
    });
    
    // --- Staking Yield Claim Listener ---
    document.getElementById('claim-staking-yield-btn').addEventListener('click', async () => {
        const rewardDistributorContract = new ethers.Contract(addresses.rewardDistributor, abis.rewardDistributor, signer);
        await handleTransaction(
            () => rewardDistributorContract.claim(),
            "Staking rewards claimed!",
            "Claiming Staking Rewards"
        );
    });
});
</script>

</body>
</html>

